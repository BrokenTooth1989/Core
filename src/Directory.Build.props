<Project>
  <PropertyGroup>
	<IsTestProject>$(MSBuildProjectName.Contains('Tests'))</IsTestProject>
	<TreatWarningsAsErrors>true</TreatWarningsAsErrors>
  <WarningsAsErrors />
  </PropertyGroup>
  
  <ItemGroup>
	  <AdditionalFiles Include="$(MSBuildThisFileDirectory)stylecop.json" Link="stylecop.json" />
  </ItemGroup>

  <ItemGroup>
      <PackageReference Include="Microsoft.CodeAnalysis.CSharp" PrivateAssets="all" Version="3.7.0" />
      <PackageReference Include="Microsoft.CodeAnalysis.FxCopAnalyzers" PrivateAssets="all" Version="3.3.0" />
      <PackageReference Include="StyleCop.Analyzers" Version="1.2.0-beta.205">
        <PrivateAssets>all</PrivateAssets>
        <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
      </PackageReference>
      <PackageReference Include="SonarAnalyzer.CSharp" Version="8.11.0.20529">
        <PrivateAssets>all</PrivateAssets>
        <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
      </PackageReference>
  </ItemGroup>

  <Choose>
	<When Condition="'$(IsTestProject)' == 'true'">
	  <PropertyGroup>
        <CodeAnalysisRuleSet>$(MSBuildThisFileDirectory)analysis.test.ruleset</CodeAnalysisRuleSet>
    </PropertyGroup>
	  
	  <ItemGroup>
		<PackageReference Include="coverlet.msbuild" Version="2.9.0">
		  <PrivateAssets>all</PrivateAssets>
		  <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.2.0" />
		<PackageReference Include="Moq" Version="4.14.5" />
		<PackageReference Include="MSTest.TestAdapter" Version="2.1.2" />
		<PackageReference Include="MSTest.TestFramework" Version="2.1.2" />
	  </ItemGroup>
	</When>
	<Otherwise>
	  <PropertyGroup>
        <CodeAnalysisRuleSet>$(MSBuildThisFileDirectory)analysis.ruleset</CodeAnalysisRuleSet>
    </PropertyGroup>
	</Otherwise>
  </Choose>
</Project>